<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Forex Quiz</title>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Supabase JS SDK â€” Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ñ CDN, Ğ±ĞµĞ· ÑĞµÑ€Ğ²ĞµÑ€Ğ° -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Manrope:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap"
    rel="stylesheet" />

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESET & TOKENS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    :root {
      --bg: #0d1117;
      --bg2: #161b27;
      --bg3: #1c2333;
      --line: #2a3a52;
      --muted: #5b7a9d;
      --soft: #8fa3be;
      --text: #d4e0f0;
      --hi: #eef4ff;
      --teal: #00c9a7;
      --teal2: #00f0c8;
      --gold: #c9a84c;
      --gold2: #f0cc74;
      --red: #e05252;
      --r: 12px;
      --serif: 'DM Serif Display', serif;
      --mono: 'DM Mono', monospace;
      --sans: 'Manrope', sans-serif;
    }

    html,
    body {
      min-height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-size: 15px;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Grid texture */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0, 201, 167, .03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 201, 167, .03) 1px, transparent 1px);
      background-size: 44px 44px;
      pointer-events: none;
      z-index: 0;
    }

    #app {
      position: relative;
      z-index: 1;
      min-height: 100vh
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREENS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .screen {
      display: none;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px 18px 40px;
      animation: up .3s cubic-bezier(.16, 1, .3, 1);
    }

    .screen.on {
      display: flex
    }

    @keyframes up {
      from {
        opacity: 0;
        transform: translateY(12px)
      }

      to {
        opacity: 1;
        transform: none
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOADING
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #sLoad {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 16px;
    }

    .spin {
      width: 38px;
      height: 38px;
      border: 2px solid var(--line);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin .7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .spin-label {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted)
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HEADER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hd {
      display: flex;
      align-items: center;
      gap: 13px;
      padding-bottom: 18px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 24px;
    }

    .hd-ico {
      width: 44px;
      height: 44px;
      flex-shrink: 0;
      background: linear-gradient(135deg, var(--teal), #0088ff);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 0 18px rgba(0, 201, 167, .2);
    }

    .hd-name {
      font-family: var(--serif);
      font-size: 20px;
      color: var(--hi);
      line-height: 1.2
    }

    .hd-sub {
      font-size: 11px;
      color: var(--muted);
      font-family: var(--mono);
      margin-top: 2px
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PROGRESS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .prog {
      margin-bottom: 22px
    }

    .prog-top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px
    }

    .prog-lbl {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted);
      letter-spacing: .04em
    }

    .prog-score {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--teal)
    }

    .bar {
      height: 3px;
      background: var(--line);
      border-radius: 99px;
      overflow: hidden
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--teal), var(--teal2));
      border-radius: 99px;
      box-shadow: 0 0 8px rgba(0, 201, 167, .45);
      transition: width .45s cubic-bezier(.4, 0, .2, 1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     QUESTION CARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .qcard {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
    }

    .qcard::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--teal), transparent);
    }

    .qnum {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--teal);
      margin-bottom: 10px;
    }

    .qtext {
      font-family: var(--serif);
      font-size: 18px;
      color: var(--hi);
      line-height: 1.45;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     OPTIONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .opts {
      display: flex;
      flex-direction: column;
      gap: 9px
    }

    .opt {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 13px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 13px;
      transition: border-color .15s, background .15s, transform .1s;
      user-select: none;
    }

    .opt:active:not(.lock) {
      transform: scale(.98)
    }

    .opt:hover:not(.lock) {
      border-color: var(--muted);
      background: var(--bg3)
    }

    .opt.lock {
      cursor: default;
      pointer-events: none
    }

    .opt-k {
      width: 30px;
      height: 30px;
      flex-shrink: 0;
      border-radius: 8px;
      background: var(--bg3);
      border: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      transition: all .15s;
    }

    .opt-v {
      font-size: 14px;
      font-weight: 500;
      flex: 1;
      line-height: 1.4
    }

    .opt.ok {
      border-color: var(--teal);
      background: rgba(0, 201, 167, .07)
    }

    .opt.ok .opt-k {
      background: var(--teal);
      color: #000;
      border-color: var(--teal);
      font-weight: 700
    }

    .opt.no {
      border-color: var(--red);
      background: rgba(224, 82, 82, .07)
    }

    .opt.no .opt-k {
      background: var(--red);
      color: #fff;
      border-color: var(--red)
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EXPLANATION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .expl {
      background: rgba(0, 201, 167, .05);
      border: 1px solid rgba(0, 201, 167, .15);
      border-radius: var(--r);
      padding: 13px 15px;
      font-size: 13px;
      color: var(--soft);
      line-height: 1.6;
      margin-top: 12px;
      display: none;
      animation: up .3s ease;
    }

    .expl.on {
      display: block
    }

    .expl b {
      color: var(--teal)
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BUTTONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: var(--r);
      font-family: var(--sans);
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: .01em;
      transition: opacity .15s, transform .1s;
    }

    .btn:active {
      transform: scale(.97);
      opacity: .9
    }

    .btn:disabled {
      opacity: .35;
      cursor: not-allowed;
      transform: none
    }

    .btn-teal {
      background: linear-gradient(135deg, var(--teal), var(--teal2));
      color: #0d1117
    }

    .btn-gold {
      background: linear-gradient(135deg, var(--gold), var(--gold2));
      color: #0d1117
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--text)
    }

    .btn-ghost:hover {
      border-color: var(--muted)
    }

    .btns {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: auto;
      padding-top: 22px
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .rhero {
      text-align: center;
      padding: 28px 0 22px
    }

    .rico {
      font-size: 52px;
      display: block;
      margin-bottom: 10px
    }

    .rtitle {
      font-family: var(--serif);
      font-size: 28px;
      color: var(--hi);
      margin-bottom: 4px
    }

    .rsub {
      font-size: 14px;
      color: var(--muted)
    }

    .rsub strong {
      color: var(--text);
      font-size: 22px;
      font-family: var(--mono)
    }

    .strack {
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 15px 18px;
      margin-bottom: 18px;
    }

    .strack-lbl {
      font-size: 10px;
      font-family: var(--mono);
      text-transform: uppercase;
      letter-spacing: .1em;
      color: var(--muted);
      margin-bottom: 9px;
    }

    .sbar {
      height: 6px;
      background: var(--bg3);
      border-radius: 99px;
      overflow: hidden
    }

    .sbar-fill {
      height: 100%;
      border-radius: 99px;
      background: linear-gradient(90deg, var(--gold), var(--gold2));
      box-shadow: 0 0 10px rgba(201, 168, 76, .35);
      transition: width .7s cubic-bezier(.16, 1, .3, 1) .15s;
    }

    .sep {
      height: 1px;
      background: var(--line);
      margin: 20px 0
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FORM
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ftitle {
      font-family: var(--serif);
      font-size: 22px;
      color: var(--hi);
      margin-bottom: 4px
    }

    .fsub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 20px
    }

    .fld {
      margin-bottom: 14px
    }

    .fld-lbl {
      display: block;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--muted);
      font-family: var(--mono);
      margin-bottom: 6px;
    }

    .fld-in,
    .fld-ta {
      width: 100%;
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 12px 14px;
      font-family: var(--sans);
      font-size: 14px;
      color: var(--hi);
      outline: none;
      resize: none;
      transition: border-color .15s, box-shadow .15s;
    }

    .fld-in::placeholder,
    .fld-ta::placeholder {
      color: var(--muted)
    }

    .fld-in:focus,
    .fld-ta:focus {
      border-color: var(--teal);
      box-shadow: 0 0 0 3px rgba(0, 201, 167, .1);
    }

    .fld-ta {
      min-height: 88px
    }

    .fld-err {
      font-size: 12px;
      color: var(--red);
      margin-top: 5px;
      display: none
    }

    .fld-err.on {
      display: block;
      animation: up .2s ease
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast {
      position: fixed;
      bottom: 26px;
      left: 50%;
      transform: translateX(-50%) translateY(60px);
      background: var(--bg2);
      border: 1px solid var(--line);
      border-radius: 99px;
      padding: 10px 22px;
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      transition: transform .35s cubic-bezier(.34, 1.56, .64, 1);
      z-index: 999;
      pointer-events: none;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .4);
    }

    .toast.on {
      transform: translateX(-50%) translateY(0)
    }

    .toast.ok {
      border-color: var(--teal);
      color: var(--teal)
    }

    .toast.err {
      border-color: var(--red);
      color: var(--red)
    }
  </style>
</head>

<body>
  <div id="app">

    <!-- Loading -->
    <div id="sLoad">
      <div class="spin"></div>
      <div class="spin-label">Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹...</div>
    </div>

    <!-- Quiz -->
    <div class="screen" id="sQuiz">
      <div class="hd">
        <div class="hd-ico">ğŸ“Š</div>
        <div>
          <div class="hd-name">Forex Quiz</div>
          <div class="hd-sub">Ñ„Ğ¾Ñ€ĞµĞºÑ Â· Ğ¸Ğ½Ğ²ĞµÑÑ‚Ğ¸Ñ†Ğ¸Ğ¸ Â· Ñ€Ñ‹Ğ½ĞºĞ¸</div>
        </div>
      </div>

      <div class="prog">
        <div class="prog-top">
          <span class="prog-lbl" id="pLbl">Ğ’ĞĞŸĞ ĞĞ¡ 1 / 3</span>
          <span class="prog-score" id="pScore">0 Ğ²ĞµÑ€Ğ½Ñ‹Ñ…</span>
        </div>
        <div class="bar">
          <div class="bar-fill" id="pFill" style="width:0%"></div>
        </div>
      </div>

      <div class="qcard">
        <div class="qnum" id="qNum">Ğ’ĞĞŸĞ ĞĞ¡ 01</div>
        <div class="qtext" id="qText">...</div>
      </div>

      <div class="opts" id="optList"></div>
      <div class="expl" id="expl"></div>

      <div class="btns">
        <button class="btn btn-teal" id="btnNext" style="display:none" onclick="next()"></button>
      </div>
    </div>

    <!-- Result + Feedback -->
    <div class="screen" id="sResult">
      <div class="hd">
        <div class="hd-ico">ğŸ†</div>
        <div>
          <div class="hd-name">Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚</div>
          <div class="hd-sub">ĞºĞ²Ğ¸Ğ· Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½</div>
        </div>
      </div>

      <div class="rhero">
        <span class="rico" id="rIco">ğŸ¯</span>
        <div class="rtitle" id="rTitle">ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!</div>
        <div class="rsub">ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…: <strong id="rScore">3 / 3</strong></div>
      </div>

      <div class="strack">
        <div class="strack-lbl">Ğ’Ğ°Ñˆ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚</div>
        <div class="sbar">
          <div class="sbar-fill" id="sFill" style="width:0%"></div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="ftitle">ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ</div>
      <div class="fsub">ĞÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹ â€” Ğ¼Ñ‹ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ñ Ğ²Ğ°Ğ¼Ğ¸</div>

      <div class="fld">
        <label class="fld-lbl">Ğ˜Ğ¼Ñ *</label>
        <input class="fld-in" id="fName" type="text" placeholder="Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ" maxlength="100" />
        <div class="fld-err" id="fNameErr">Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ</div>
      </div>

      <div class="fld">
        <label class="fld-lbl">Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ *</label>
        <textarea class="fld-ta" id="fMsg" placeholder="Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹..." maxlength="1000"></textarea>
        <div class="fld-err" id="fMsgErr">ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ</div>
      </div>

      <div class="btns">
        <button class="btn btn-gold" id="btnSend" onclick="send()">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
        <button class="btn btn-ghost" onclick="restart()">ğŸ”„ ĞŸÑ€Ğ¾Ğ¹Ñ‚Ğ¸ ĞµÑ‰Ñ‘ Ñ€Ğ°Ğ·</button>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯ SUPABASE
    // anon key â€” ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½ Ğ´Ğ»Ñ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SUPABASE_URL = 'https://bokoiljrbigobkemslxh.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJva29pbGpyYmlnb2JrZW1zbHhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2OTA2MzksImV4cCI6MjA4NjI2NjYzOX0.ZLUKFKZkx85fXtJJlu-BtPcBoQgp1cJvlvkyGeFFU_M';
    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ: Supabase â†’ Settings â†’ API â†’ anon public

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TELEGRAM
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const tg = window.Telegram?.WebApp ?? null;
    if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#0d1117'); tg.setBackgroundColor('#0d1117'); }
    const TG = tg?.initDataUnsafe?.user ?? null;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const LABELS = ['A', 'B', 'C', 'D'];
    let questions = [], cur = 0, score = 0, answered = false, answers = [];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT â€” Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸Ğ· Supabase
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function init() {
      try {
        const { data, error } = await sb
          .from('quiz_questions')
          .select('id, question_text, options, correct_index, explanation')
          .eq('is_active', true)
          .limit(3)
          .order('id'); // Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ° ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ñ‡ĞµÑ€ĞµĞ· RPC

        if (error) throw error;
        if (!data?.length) throw new Error('ĞĞµÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ±Ğ°Ğ·Ğµ');

        // ĞŸĞµÑ€ĞµĞ¼ĞµÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾ Ğ½Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ
        questions = data.sort(() => Math.random() - 0.5);

        hide('sLoad');
        show('sQuiz');
        render();
      } catch (e) {
        console.error(e);
        g('sLoad').innerHTML = `
      <div style="text-align:center;padding:40px 20px">
        <div style="font-size:44px;margin-bottom:12px">âš ï¸</div>
        <div style="font-family:'DM Serif Display',serif;font-size:20px;color:#eef4ff;margin-bottom:8px">ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸</div>
        <div style="font-size:13px;color:#5b7a9d">${e.message}</div>
      </div>`;
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER QUESTION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function render() {
      answered = false;
      const q = questions[cur];
      const opts = Array.isArray(q.options) ? q.options : JSON.parse(q.options);
      const pct = (cur / questions.length) * 100;

      g('pFill').style.width = pct + '%';
      g('pLbl').textContent = `Ğ’ĞĞŸĞ ĞĞ¡ ${cur + 1} / ${questions.length}`;
      g('pScore').textContent = score + ' Ğ²ĞµÑ€Ğ½Ñ‹Ñ…';
      g('qNum').textContent = 'Ğ’ĞĞŸĞ ĞĞ¡ ' + String(cur + 1).padStart(2, '0');
      g('qText').textContent = q.question_text;

      g('optList').innerHTML = opts.map((o, i) => `
    <div class="opt" id="o${i}" onclick="pick(${i})">
      <div class="opt-k">${LABELS[i]}</div>
      <div class="opt-v">${o}</div>
    </div>`).join('');

      const ex = g('expl');
      ex.classList.remove('on');
      ex.innerHTML = '';
      const bn = g('btnNext');
      bn.style.display = 'none';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PICK ANSWER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function pick(idx) {
      if (answered) return;
      answered = true;

      const q = questions[cur];
      const opts = Array.isArray(q.options) ? q.options : JSON.parse(q.options);
      const correct = q.correct_index;
      const right = idx === correct;

      if (right) score++;
      answers.push({ question_id: q.id, chosen: idx, correct, is_correct: right });

      opts.forEach((_, i) => {
        const d = g('o' + i);
        d.classList.add('lock');
        if (i === correct) d.classList.add('ok');
        if (i === idx && !right) d.classList.add('no');
      });

      if (q.explanation) {
        const ex = g('expl');
        ex.innerHTML = `<b>${right ? 'âœ“ Ğ’ĞµÑ€Ğ½Ğ¾!' : 'âœ— ĞĞµĞ²ĞµÑ€Ğ½Ğ¾.'}</b> ${q.explanation}`;
        ex.classList.add('on');
      }

      g('pScore').textContent = score + ' Ğ²ĞµÑ€Ğ½Ñ‹Ñ…';
      const bn = g('btnNext');
      bn.style.display = 'block';
      bn.textContent = cur + 1 < questions.length ? 'Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ â†’' : 'Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ âœ“';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NEXT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function next() {
      cur++;
      if (cur >= questions.length) {
        saveResult();
        showResult();
      } else {
        render();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SAVE RESULT â†’ Supabase (fire and forget)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function saveResult() {
      try {
        await sb.from('quiz_results').insert({
          tg_user_id: TG?.id ?? null,
          tg_username: TG?.username ?? null,
          score,
          total: questions.length,
          answers: answers,
        });
      } catch (e) { console.warn('result save:', e.message); }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SHOW RESULT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showResult() {
      const total = questions.length;
      const pct = Math.round(score / total * 100);
      const cfg = score === total ? { ico: 'ğŸ†', title: 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚!' }
        : score >= total - 1 ? { ico: 'ğŸ¯', title: 'ĞŸĞ¾Ñ‡Ñ‚Ğ¸ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾!' }
          : score >= 1 ? { ico: 'ğŸ“ˆ', title: 'ĞĞµĞ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚!' }
            : { ico: 'ğŸ’ª', title: 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹ ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ!' };

      g('rIco').textContent = cfg.ico;
      g('rTitle').textContent = cfg.title;
      g('rScore').textContent = `${score} / ${total}`;

      if (TG?.first_name) g('fName').value = TG.first_name;

      hide('sQuiz');
      show('sResult');
      setTimeout(() => { g('sFill').style.width = pct + '%'; }, 100);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SEND FEEDBACK â†’ Supabase
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function send() {
      const nameEl = g('fName'), msgEl = g('fMsg');
      const nameEr = g('fNameErr'), msgEr = g('fMsgErr');
      const btn = g('btnSend');

      nameEr.classList.remove('on');
      msgEr.classList.remove('on');

      let ok = true;
      if (!nameEl.value.trim()) { nameEr.classList.add('on'); ok = false; }
      if (!msgEl.value.trim()) { msgEr.classList.add('on'); ok = false; }
      if (!ok) return;

      btn.disabled = true;
      btn.textContent = 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼...';

      try {
        const { error } = await sb.from('feedback').insert({
          tg_user_id: TG?.id ?? null,
          name: nameEl.value.trim(),
          message: msgEl.value.trim(),
          quiz_score: score,
        });

        if (error) throw error;

        toast('âœ“ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!', 'ok');
        nameEl.value = '';
        msgEl.value = '';
        btn.textContent = 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ âœ“';
        
        if (tg) {
          // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ğ¾Ñ‚Ñƒ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼
          tg.sendData(JSON.stringify({
            type: 'feedback_sent',
            score,
            total: questions.length,
          }));
          setTimeout(() => tg.close(), 1800);
        }
      } catch (e) {
        toast('âœ— ' + (e.message || 'ĞÑˆĞ¸Ğ±ĞºĞ°'), 'err');
        btn.disabled = false;
        btn.textContent = 'ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RESTART
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function restart() {
      cur = 0; score = 0; answered = false; answers = [];
      hide('sResult');
      g('sLoad').style.display = 'flex';
      g('sLoad').innerHTML = '<div class="spin"></div><div class="spin-label">Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹...</div>';
      await init();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const g = id => document.getElementById(id);
    const show = id => { const el = g(id); el.style.display = ''; el.classList.add('on'); };
    const hide = id => { const el = g(id); el.classList.remove('on'); el.style.display = 'none'; };

    function toast(msg, type = 'ok') {
      const t = g('toast');
      t.textContent = msg;
      t.className = `toast ${type} on`;
      setTimeout(() => t.classList.remove('on'), 3000);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    init();
  </script>
</body>

</html>